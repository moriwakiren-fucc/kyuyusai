<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>動画分岐再生</title>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      height: 100%;
      background: black;
      overflow: hidden;
    }
    video {
      width: 100%;
      height: 100%;
      object-fit: cover; /* 全画面にフィット */
    }
  </style>
</head>
<body>
  <!-- 最初は黒画面。muted + playsinline はブラウザの再生規制回避用 -->
  <video id="player" muted playsinline></video>

  <script>
    const video = document.getElementById("player");

    // 遷移ルールをファイル名で定義
    const transitions = {
      "0.mp4": { L: "1_L.mp4", A: "1_R.mp4" },
      "1_L.mp4": { L: "2_L.mp4", A: "2_R.mp4" },
      "2_R.mp4": { L: "3_L.mp4", A: "3_R.mp4" }
    };

    let nextChoice = null; // キー入力を記録
    let started = false;   // スペースキーで開始したかどうか

    // 動画を再生する関数
    function playVideo(filename) {
      video.src = filename;      // 同じフォルダの動画を読み込み
      video.play().catch(err => {
        console.error("再生エラー:", err);
      });
      nextChoice = null;
    }

    // キー入力
    window.addEventListener("keydown", (e) => {
      if (!started && e.code === "Space") {
        // スペースキーで最初の動画開始
        started = true;
        video.muted = false; // 音を有効化
        playVideo("0.mp4");
      } else if (e.key === "ArrowLeft" || e.key === "l" || e.key === "L") {
        nextChoice = "L";
      } else if (e.key === "ArrowRight" || e.key === "a" || e.key === "A") {
        nextChoice = "A";
      }
    });

    // 動画終了時の処理
    video.addEventListener("ended", () => {
      const filename = video.src.split("/").pop(); // ファイル名だけ取り出す
      const rule = transitions[filename];
      if (rule && nextChoice && rule[nextChoice]) {
        playVideo(rule[nextChoice]);
      }
    });
  </script>
</body>
</html>

