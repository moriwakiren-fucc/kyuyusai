<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>動画分岐再生</title>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      height: 100%;
      background: black;
      overflow: hidden;
    }
    video {
      width: 100%;
      height: 100%;
      object-fit: cover; /* 画面いっぱいに表示 */
    }
  </style>
</head>
<body>
  <!-- 最初はmuted + playsinline を必ず付ける -->
  <video id="player" muted playsinline></video>

  <script>
    const video = document.getElementById("player");

    // 動画の遷移ルール（フルURLで統一）
    const transitions = {
      "https://moriwakiren-fucc.github.io/kyuyusai/0.mov": { 
        L: "https://moriwakiren-fucc.github.io/kyuyusai/1_L.mov", 
        A: "https://moriwakiren-fucc.github.io/kyuyusai/1_R.mov" 
      },
      "https://moriwakiren-fucc.github.io/kyuyusai/1_L.mov": { 
        L: "https://moriwakiren-fucc.github.io/kyuyusai/2_L.mp4", 
        A: "https://moriwakiren-fucc.github.io/kyuyusai/2_R.mov" 
      },
      "https://moriwakiren-fucc.github.io/kyuyusai/2_R.mov": { 
        L: "https://moriwakiren-fucc.github.io/kyuyusai/3_L.mov", 
        A: "https://moriwakiren-fucc.github.io/kyuyusai/3_R.mp4" 
      }
    };

    let nextChoice = null; // 押されたキーを記録する
    let started = false;   // スペースキーで開始したかどうか

    function playVideo(filename) {
      video.src = filename;
      video.play().catch(err => {
        console.error("再生エラー:", err);
      });
      nextChoice = null;
    }

    // キー入力を記録
    window.addEventListener("keydown", (e) => {
      if (!started && e.code === "Space") {
        // スペースキーで最初の動画を開始
        started = true;
        video.muted = false; // 音を有効化
        playVideo("https://moriwakiren-fucc.github.io/kyuyusai/0.mov");
      } else if (e.key === "ArrowLeft" || e.key === "l" || e.key === "L") {
        nextChoice = "L";
      } else if (e.key === "ArrowRight" || e.key === "a" || e.key === "A") {
        nextChoice = "A";
      }
    });

    // 動画が終わった瞬間に次を再生
    video.addEventListener("ended", () => {
      const rule = transitions[video.src];
      if (rule && nextChoice && rule[nextChoice]) {
        playVideo(rule[nextChoice]);
      }
    });
  </script>
</body>
</html>
